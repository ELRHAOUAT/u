<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TP Sécurité : Injection SQL & Mutillidae</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --danger-color: #e74c3c;
            --success-color: #27ae60;
            --warning-bg: #f39c12;
            --code-bg: #1e1e1e;
            --text-light: #ecf0f1;
            --bg-light: #f8f9fa;
        }

        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: #333;
            margin: 0;
            background-color: var(--bg-light);
        }

        /* Header & Hero */
        header {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            padding: 3rem 1rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        header h1 {
            margin: 0;
            font-size: 2.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-top: 10px;
        }

        .meta-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .meta-tag {
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
        }

        /* Navigation */
        nav {
            background: #fff;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            padding: 0.5rem;
        }

        nav a {
            text-decoration: none;
            color: var(--primary-color);
            padding: 10px 20px;
            font-weight: bold;
            transition: color 0.3s;
        }

        nav a:hover {
            color: var(--accent-color);
        }

        /* Container */
        .container {
            max-width: 900px;
            margin: 40px auto;
            padding: 0 20px;
        }

        /* Sections */
        section {
            background: white;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 5px solid var(--accent-color);
        }

        h2 {
            color: var(--primary-color);
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h3 {
            color: var(--accent-color);
            margin-top: 25px;
        }

        /* Alerts & Callouts */
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            display: flex;
            align-items: start;
            gap: 10px;
        }

        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }

        .alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Steps List */
        .step-list {
            list-style: none;
            padding: 0;
            counter-reset: step-counter;
        }

        .step-list li {
            position: relative;
            padding-left: 50px;
            margin-bottom: 20px;
        }

        .step-list li::before {
            counter-increment: step-counter;
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            width: 35px;
            height: 35px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: bold;
        }

        /* Code Blocks */
        pre {
            background-color: var(--code-bg);
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Fira Code', monospace;
            border: 1px solid #333;
        }

        code {
            font-family: 'Fira Code', monospace;
        }
        
        .inline-code {
            background-color: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
            color: #c7254e;
            font-size: 0.9em;
        }

        .sql-keyword { color: #569cd6; font-weight: bold; }
        .sql-string { color: #ce9178; }
        .sql-comment { color: #6a9955; font-style: italic; }

        /* Images (Placeholders styling) */
        .img-placeholder {
            width: 100%;
            height: 200px;
            background: linear-gradient(to right, #eef2f3, #8e9eab);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #555;
            font-weight: bold;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px dashed #bdc3c7;
        }
        
        .btn {
            display: inline-block;
            background: var(--accent-color);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .btn:hover { background: #2980b9; }

        footer {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 0.9rem;
            border-top: 1px solid #ddd;
        }

        /* Responsive */
        @media (max-width: 600px) {
            header h1 { font-size: 1.8rem; }
            .meta-info { flex-direction: column; gap: 10px; }
            nav { overflow-x: auto; white-space: nowrap; justify-content: flex-start; }
        }
    </style>
</head>
<body>

<header>
    <h1><i class="fa-solid fa-shield-halved"></i> Audit de Sécurité Web</h1>
    <p>TP : Injection SQL sur Environnement Mutillidae II</p>
    <div class="meta-info">
        <span class="meta-tag"><i class="fa-solid fa-graduation-cap"></i> Dev. Digital</span>
        <span class="meta-tag"><i class="fa-regular fa-clock"></i> Durée : 2h30</span>
        <span class="meta-tag"><i class="fa-solid fa-layer-group"></i> Niveau : Intermédiaire</span>
    </div>
</header>

<nav>
    <a href="#setup"><i class="fa-solid fa-server"></i> Installation</a>
    <a href="#attack"><i class="fa-solid fa-bug"></i> Attaque (SQLi)</a>
    <a href="#defense"><i class="fa-solid fa-lock"></i> Défense (Dev)</a>
    <a href="#eval"><i class="fa-solid fa-check-double"></i> Évaluation</a>
</nav>

<div class="container">

    <section>
        <h2><i class="fa-solid fa-circle-info"></i> Introduction</h2>
        <p>
            Dans ce TP, vous allez auditer une application web vulnérable réaliste. 
            L'objectif n'est pas seulement de "casser" le site, mais de comprendre comment une base de données 
            interagit avec le code PHP et comment sécuriser vos futures applications.
        </p>
        <div class="alert alert-warning">
            <i class="fa-solid fa-triangle-exclamation"></i>
            <strong>Important :</strong> Ce TP se déroule entièrement en local (Localhost). 
            Il est interdit de tester ces techniques sur des sites publics.
        </div>
    </section>

    <section id="setup">
        <h2><i class="fa-solid fa-toolbox"></i> 1. Préparation du Lab (Anti-Bug)</h2>
        <p>Pour éviter les erreurs techniques liées aux versions récentes de PHP, suivez ces instructions à la lettre.</p>

        <ul class="step-list">
            <li>
                <strong>Installation de XAMPP</strong><br>
                Installez XAMPP à la racine <code>C:\xampp</code>. Lancez Apache et MySQL.
            </li>
            <li>
                <strong>Configuration PHP (Essentiel)</strong><br>
                Ouvrez <em>XAMPP > Config (Apache) > php.ini</em>. <br>
                Cherchez <code>display_errors = On</code> et remplacez par :
                <pre>display_errors = Off</pre>
                <small>Redémarrez Apache après modification.</small>
            </li>
            <li>
                <strong>Installation de Mutillidae</strong><br>
                Téléchargez le projet depuis GitHub et extrayez-le dans <code>C:\xampp\htdocs\mutillidae</code>.<br>
                <span style="color:var(--danger-color); font-weight:bold;">Supprimez le fichier .htaccess dans ce dossier.</span>
            </li>
            <li>
                <strong>Configuration BDD</strong><br>
                Dans <code>includes/database-config.php</code> :
                <pre>
$dbHost = '127.0.0.1';
$dbUser = 'root';
$dbPassword = '';
$dbName = 'mutillidae4';</pre>
            </li>
            <li>
                <strong>Génération Automatique des Données</strong><br>
                C'est l'étape magique. Cliquez sur ce lien pour créer la BDD et les faux comptes :<br>
                <a href="http://localhost/mutillidae/set-up-database.php" target="_blank" class="btn">Lancer le script d'installation <i class="fa-solid fa-rocket"></i></a>
            </li>
        </ul>
    </section>

    <section id="attack">
        <h2><i class="fa-solid fa-user-secret"></i> 2. Phase d'Exploitation (Pentest)</h2>
        <div class="alert alert-info">
            <strong>Vérification :</strong> Assurez-vous que le niveau de sécurité sur le site est : <code>Security Level: 0 (Hosed)</code>.
        </div>

        <h3><i class="fa-solid fa-unlock"></i> Exercice A : Bypass d'Authentification</h3>
        <p><strong>Scénario :</strong> Se connecter en tant qu'administrateur sans connaître le mot de passe.</p>
        <p><strong>Chemin :</strong> OWASP 2017 > A1 Injection > SQL Injection > Bypass Authentication > Login</p>
        
        <div class="img-placeholder">
            <i class="fa-solid fa-image fa-2x"></i> &nbsp; [Image: Formulaire de Login Mutillidae]
        </div>

        <p>Dans le champ <strong>Name</strong>, injectez ce payload :</p>
        <pre><span class="sql-keyword">admin</span><span class="sql-string">' OR 1=1 -- </span></pre>
        <p><em>Note : Il y a un espace obligatoire après les deux tirets !</em></p>

        <h3><i class="fa-solid fa-database"></i> Exercice B : Vol de Données (UNION)</h3>
        <p><strong>Objectif :</strong> Extraire la liste des utilisateurs et mots de passe cachés dans la base.</p>
        <p><strong>Chemin :</strong> OWASP 2017 > A1 Injection > SQL Injection > Extract Data > User Info</p>

        <ol>
            <li>
                <strong>Trouver le nombre de colonnes :</strong><br>
                <code>admin' ORDER BY 5 -- </code>
            </li>
            <li>
                <strong>Localiser l'affichage :</strong><br>
                <code>' UNION SELECT 1, 2, 3, 4, 5 -- </code>
            </li>
            <li>
                <strong>Dumper la table des comptes :</strong><br>
                <pre><span class="sql-string">'</span> <span class="sql-keyword">UNION SELECT</span> 1, username, password, 4, 5 <span class="sql-keyword">FROM</span> accounts <span class="sql-comment">-- </span></pre>
            </li>
        </ol>
    </section>

    <section id="defense">
        <h2><i class="fa-solid fa-code"></i> 3. Phase de Défense (Secure Coding)</h2>
        <p>En tant que développeur, vous devez savoir corriger cette faille. Le problème vient de la concaténation.</p>

        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 300px;">
                <h4 style="color: var(--danger-color);"><i class="fa-solid fa-xmark"></i> Code Vulnérable</h4>
                <pre>
$user = $_POST['name'];
<span class="sql-comment">// Mauvais : Concaténation</span>
$sql = <span class="sql-string">"SELECT * FROM users WHERE name = '"</span> . $user . <span class="sql-string">"'"</span>;</pre>
            </div>
            <div style="flex: 1; min-width: 300px;">
                <h4 style="color: var(--success-color);"><i class="fa-solid fa-check"></i> Code Sécurisé (PDO)</h4>
                <pre>
$user = $_POST['name'];
<span class="sql-comment">// Bon : Requête Préparée</span>
$stmt = $pdo->prepare(<span class="sql-string">'SELECT * FROM users WHERE name = :n'</span>);
$stmt->execute(['n' => $user]);</pre>
            </div>
        </div>
        <p><strong>Pourquoi ?</strong> Avec PDO, la base de données traite l'entrée utilisateur strictement comme du texte, jamais comme une commande exécutable.</p>
    </section>

    <section id="eval">
        <h2><i class="fa-solid fa-clipboard-check"></i> 4. Critères de Validation</h2>
        <p>Pour valider ce TP, préparez un mini-rapport contenant :</p>
        <ul class="step-list">
            <li>Une capture d'écran prouvant que vous êtes connecté en tant qu'<strong>Admin</strong>.</li>
            <li>Une capture d'écran de la liste des <strong>mots de passe extraits</strong> (hashs).</li>
            <li>Le snippet de code PHP corrigé expliquant l'utilité de la fonction <code>prepare()</code>.</li>
        </ul>
    </section>

</div>

<footer>
    <p>TP Développement Digital - Module Sécurité des Applications Web</p>
    <p><i class="fa-brands fa-github"></i> Hébergé sur GitHub Pages | Mutillidae II Lab</p>
</footer>

</body>
</html>
